"use strict";
var _ = require('lodash');
var ProductStatus = require('../model/ProductStatus');
var Product = require('../model/Product');
var ProductDocumentManager = require('../model/ProductDocumentManager');
var ProductManager = (function () {
    function ProductManager() {
    }
    ProductManager.create = function (product, callback) {
        if (!product)
            return callback(new Error("Cannot create null or undefined Object"), null);
        product.create_date = product.create_date || new Date();
        product.status = product.status || ProductStatus.ACTIVE;
        ProductDocumentManager.create(product, function (createErr, document) {
            if (createErr)
                return callback(createErr, null);
            if (!document)
                return callback(new Error("Create Error"), null);
            callback(null, new Product(document));
        });
    };
    ;
    ProductManager.findById = function (product_id, options, callback) {
        if (!product_id)
            return callback(new Error("Missing ID"), null);
        var criteria = { gid: product_id };
        if (!options || !options.include_inactive) {
            criteria['status'] = ProductStatus.ACTIVE;
        }
        ProductDocumentManager.findOne(criteria, function (findErr, document) {
            if (findErr)
                return callback(findErr, null);
            if (!document)
                return callback(null, null);
            callback(null, new Product(document));
        });
    };
    ProductManager.removeById = function (product_id, callback) {
        if (!product_id)
            return callback(new Error("Missing ID"), null);
        var criteria = { gid: product_id };
        ProductDocumentManager.remove(criteria, callback);
    };
    ProductManager.update = function (product, edits, callback) {
        if (!product || !edits)
            return callback(null, null);
        var mongo_id = product.id;
        var productJson = product.toDocument();
        _.assign(productJson, ProductManager.sanitize(edits));
        ProductDocumentManager.findByIdAndUpdate(mongo_id, productJson, function (updateErr, document) {
            if (updateErr)
                return callback(updateErr, null);
            if (!document)
                return callback(null, null);
            callback(null, new Product(document));
        });
    };
    ProductManager.sanitize = function (product) {
        return _.pick(product, 'name', 'gid', 'current_price', 'create_date', 'status');
    };
    return ProductManager;
}());
module.exports = ProductManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2R1Y3QvbGliL1Byb2R1Y3RNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFPLENBQUMsV0FBVyxRQUFRLENBQUMsQ0FBQztBQUc3QixJQUFPLGFBQWEsV0FBVyx3QkFBd0IsQ0FBQyxDQUFDO0FBQ3pELElBQU8sT0FBTyxXQUFXLGtCQUFrQixDQUFDLENBQUM7QUFFN0MsSUFBTyxzQkFBc0IsV0FBVyxpQ0FBaUMsQ0FBQyxDQUFDO0FBRzNFO0lBQUE7SUEwREEsQ0FBQztJQXpEaUIscUJBQU0sR0FBcEIsVUFBcUIsT0FBeUIsRUFBRSxRQUFrRDtRQUM5RixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxLQUFLLENBQUMsd0NBQXdDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUV6RixPQUFPLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLElBQUksSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN4RCxPQUFPLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLElBQUksYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUV4RCxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQUMsU0FBUyxFQUFFLFFBQXlCO1lBQ3hFLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQztnQkFBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRCxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztnQkFBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2hFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7O0lBRWEsdUJBQVEsR0FBdEIsVUFBdUIs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bXBvcnQgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuaW1wb3J0IGFzeW5jID0gcmVxdWlyZSgnYXN5bmMnKTtcblxuaW1wb3J0IFByb2R1Y3RTdGF0dXMgPSByZXF1aXJlKCcuLi9tb2RlbC9Qcm9kdWN0U3RhdHVzJyk7XG5pbXBvcnQgUHJvZHVjdCA9IHJlcXVpcmUoJy4uL21vZGVsL1Byb2R1Y3QnKTtcbmltcG9ydCBQcm9kdWN0SW50ZXJmYWNlID0gcmVxdWlyZSgnLi4vbW9kZWwvUHJvZHVjdEludGVyZmFjZScpO1xuaW1wb3J0IFByb2R1Y3REb2N1bWVudE1hbmFnZXIgPSByZXF1aXJlKCcuLi9tb2RlbC9Qcm9kdWN0RG9jdW1lbnRNYW5hZ2VyJyk7XG5pbXBvcnQgUHJvZHVjdERvY3VtZW50ID0gcmVxdWlyZSgnLi4vbW9kZWwvUHJvZHVjdERvY3VtZW50Jyk7XG5cbmNsYXNzIFByb2R1Y3RNYW5hZ2VyIHtcbiAgICBwdWJsaWMgc3RhdGljIGNyZWF0ZShwcm9kdWN0OiBQcm9kdWN0SW50ZXJmYWNlLCBjYWxsYmFjazogKGVyciwgcHJvZHVjdDogUHJvZHVjdEludGVyZmFjZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICBpZiAoIXByb2R1Y3QpIHJldHVybiBjYWxsYmFjayhuZXcgRXJyb3IoXCJDYW5ub3QgY3JlYXRlIG51bGwgb3IgdW5kZWZpbmVkIE9iamVjdFwiKSwgbnVsbCk7XG5cbiAgICAgICAgcHJvZHVjdC5jcmVhdGVfZGF0ZSA9IHByb2R1Y3QuY3JlYXRlX2RhdGUgfHwgbmV3IERhdGUoKTtcbiAgICAgICAgcHJvZHVjdC5zdGF0dXMgPSBwcm9kdWN0LnN0YXR1cyB8fCBQcm9kdWN0U3RhdHVzLkFDVElWRTtcblxuICAgICAgICBQcm9kdWN0RG9jdW1lbnRNYW5hZ2VyLmNyZWF0ZShwcm9kdWN0LCAoY3JlYXRlRXJyLCBkb2N1bWVudDogUHJvZHVjdERvY3VtZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoY3JlYXRlRXJyKSByZXR1cm4gY2FsbGJhY2soY3JlYXRlRXJyLCBudWxsKTtcbiAgICAgICAgICAgIGlmICghZG9jdW1lbnQpIHJldHVybiBjYWxsYmFjayhuZXcgRXJyb3IoXCJDcmVhdGUgRXJyb3JcIiksIG51bGwpO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgbmV3IFByb2R1Y3QoZG9jdW1lbnQpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzdGF0aWMgZmluZEJ5SWQocHJvZHVjdF9pZDogc3RyaW5nLCBvcHRpb25zOiB7IGluY2x1ZGVfaW5hY3RpdmU/OiBib29sZWFuIH0sIGNhbGxiYWNrOiAoZXJyLCBwcm9kdWN0OiBQcm9kdWN0SW50ZXJmYWNlKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIGlmICghcHJvZHVjdF9pZCkgcmV0dXJuIGNhbGxiYWNrKG5ldyBFcnJvcihcIk1pc3NpbmcgSURcIiksIG51bGwpO1xuXG4gICAgICAgIHZhciBjcml0ZXJpYSA9IHsgZ2lkOiBwcm9kdWN0X2lkIH07XG4gICAgICAgIGlmICghb3B0aW9ucyB8fCAhb3B0aW9ucy5pbmNsdWRlX2luYWN0aXZlKSB7XG4gICAgICAgICAgICBjcml0ZXJpYVsnc3RhdHVzJ10gPSBQcm9kdWN0U3RhdHVzLkFDVElWRTtcbiAgICAgICAgfVxuXG4gICAgICAgIFByb2R1Y3REb2N1bWVudE1hbmFnZXIuZmluZE9uZShjcml0ZXJpYSwgKGZpbmRFcnIsIGRvY3VtZW50OiBQcm9kdWN0RG9jdW1lbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChmaW5kRXJyKSByZXR1cm4gY2FsbGJhY2soZmluZEVyciwgbnVsbCk7XG4gICAgICAgICAgICBpZiAoIWRvY3VtZW50KSByZXR1cm4gY2FsbGJhY2sobnVsbCwgbnVsbCk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBuZXcgUHJvZHVjdChkb2N1bWVudCkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHJlbW92ZUJ5SWQocHJvZHVjdF9pZDogc3RyaW5nLCBjYWxsYmFjayk6IHZvaWQge1xuICAgICAgICBpZiAoIXByb2R1Y3RfaWQpIHJldHVybiBjYWxsYmFjayhuZXcgRXJyb3IoXCJNaXNzaW5nIElEXCIpLCBudWxsKTtcblxuICAgICAgICB2YXIgY3JpdGVyaWEgPSB7IGdpZDogcHJvZHVjdF9pZCB9O1xuICAgICAgICBQcm9kdWN0RG9jdW1lbnRNYW5hZ2VyLnJlbW92ZShjcml0ZXJpYSwgY2FsbGJhY2spO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgdXBkYXRlKHByb2R1Y3Q6IFByb2R1Y3RJbnRlcmZhY2UsIGVkaXRzOiB7fSwgY2FsbGJhY2s6IChlcnIsIHByb2R1Y3Q6IFByb2R1Y3RJbnRlcmZhY2UpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgaWYgKCFwcm9kdWN0IHx8ICFlZGl0cykgcmV0dXJuIGNhbGxiYWNrKG51bGwsIG51bGwpO1xuXG4gICAgICAgIHZhciBtb25nb19pZCA9IHByb2R1Y3QuaWQ7XG4gICAgICAgIHZhciBwcm9kdWN0SnNvbiA9IHByb2R1Y3QudG9Eb2N1bWVudCgpO1xuICAgICAgICBfLmFzc2lnbihwcm9kdWN0SnNvbiwgUHJvZHVjdE1hbmFnZXIuc2FuaXRpemUoZWRpdHMpKTtcblxuICAgICAgICBQcm9kdWN0RG9jdW1lbnRNYW5hZ2VyLmZpbmRCeUlkQW5kVXBkYXRlKG1vbmdvX2lkLCBwcm9kdWN0SnNvbiwgKHVwZGF0ZUVyciwgZG9jdW1lbnQ6IFByb2R1Y3REb2N1bWVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKHVwZGF0ZUVycikgcmV0dXJuIGNhbGxiYWNrKHVwZGF0ZUVyciwgbnVsbCk7XG4gICAgICAgICAgICBpZiAoIWRvY3VtZW50KSByZXR1cm4gY2FsbGJhY2sobnVsbCwgbnVsbCk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBuZXcgUHJvZHVjdChkb2N1bWVudCkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBzYW5pdGl6ZShwcm9kdWN0OiB7fSk6IHt9IHtcbiAgICAgICAgcmV0dXJuIF8ucGljayhwcm9kdWN0LFxuICAgICAgICAgICAgJ25hbWUnLFxuICAgICAgICAgICAgJ2dpZCcsXG4gICAgICAgICAgICAnY3VycmVudF9wcmljZScsXG4gICAgICAgICAgICAnY3JlYXRlX2RhdGUnLFxuICAgICAgICAgICAgJ3N0YXR1cycpO1xuICAgIH1cbn1cblxuZXhwb3J0ID0gUHJvZHVjdE1hbmFnZXI7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
